#!/usr/bin/env bash  # Указание интерпретатора для выполнения скрипта

# Объявить переменные
TASKID=16  # Создание переменной TASKID и присвоение ей значения 16

# Подсчет количества строк в файле dns-tunneling.log и сохранение результата в переменной VAR_1
VAR_1=$(wc -l < dns-tunneling.log | awk '{print $1}')

# Альтернативный способ подсчета количества строк, без использования awk
VAR_1=$(wc -l < "dns-tunneling.log")

# Вывод количества строк в файле dns-tunneling.log
echo $VAR_1


awk -F'\t' '$12 == 3 {print $5}' dns-tunneling.log | sort -n -t . -k 1,1 -k 2,2 -k 3,3 -k 4,4 | uniq -c | awk '{print $2 "\t" $1}' | sort -k2,2nr -s > results.txt

# Подсчет количества строк в файле results.txt и сохранение результата в переменной VAR_2
VAR_2=$(wc -l < results.txt)

# Вывод количества строк в файле results.txt
echo "VAR_2: $VAR_2"

# Вывод значений переменных (закомментированные строки)
# echo "TASKID is $TASKID"
# echo "VAR_1 is $VAR_1"
# echo "VAR_2 is $VAR_2"
























Обработка файла с помощью awk и сортировка IP-адресов
1. awk -F'\t' '$12 == 3 {print $5}': Фильтрация строк, где 12-е поле равно 3, и вывод 5-го поля (IP-адреса)
2. sort -n -t . -k 1,1 -k 2,2 -k 3,3 -k 4,4: Сортировка IP-адресов в числовом порядке по каждому октету
3. uniq -c: Подсчет количества уникальных IP-адресов
4. awk '{print $2 "\t" $1}': Перестановка столбцов для вывода сначала IP-адреса, затем количества его вхождений
5. sort -k2,2nr -s: Сортировка по количеству вхождений в порядке убывания
6. > results.txt: Сохранение результата в файл results.txt



Опции команды sort:
-n (numeric) — Числовая сортировка:

Этот флаг указывает на то, что сортировка должна выполняться числово, а не в лексикографическом (строковом) порядке.
Например, при сортировке чисел 1, 10, 2 в строковом режиме сортировки результат был бы 1, 10, 2, а при числовой сортировке результат будет 1, 2, 10.
В данном случае числовая сортировка важна, так как сортируются IP-адреса, состоящие из чисел.
-t . (delimiter) — Задание разделителя полей:

Опция -t задает разделитель полей. В данном случае это символ . (точка).
Эта опция указывает команде sort, что поля в данных разделяются точками (например, в IP-адресах), и сортировка будет происходить по отдельным полям, разделенным этим символом.
-k (key) — Указание ключей сортировки:

Опция -k указывает, по каким полям необходимо выполнять сортировку. В синтаксисе -k используется формат N,M, где:
N — номер начального поля (с которого начинается сортировка).
M — номер конечного поля (на котором заканчивается сортировка).
Например, в -k 1,1 сортировка происходит только по первому полю, в -k 1,2 сортировка охватывает первое и второе поле.
1,1, 2,2, 3,3, 4,4 — Сортировка по каждому октету IP-адреса:

В команде sort IP-адреса разбиваются на 4 части (октета), разделенные точками.
-k 1,1 сортирует по первому октету (первое число в IP-адресе).
-k 2,2 сортирует по второму октету (второе число в IP-адресе).
-k 3,3 сортирует по третьему октету (третье число в IP-адресе).
-k 4,4 сортирует по четвертому октету (четвертое число в IP-адресе).
Таким образом, IP-адреса сортируются последовательно по каждому из четырех октетов. Это гарантирует, что IP-адреса будут отсортированы в правильном порядке.


-k2,2nr:

-k2,2 указывает на сортировку по второму полю.
nr — комбинация флагов, где:
n — числовая сортировка (как описано выше).
r — обратный порядок сортировки (от большего к меньшему).
-s (stable) — Устойчивая сортировка:

Устойчивая сортировка сохраняет порядок элементов, у которых одинаковые ключи.
Это важно, если необходимо сохранить относительный порядок строк, у которых одинаковое значение во втором поле (в данном случае количество вхождений).

 -F'\t' в awk
-F — это опция, используемая в команде awk, чтобы указать символ-разделитель полей.
'\t' — это значение этой опции, означающее, что в качестве разделителя используется табуляция (\t).

uniq -c
uniq — это команда, которая используется для удаления повторяющихся строк в отсортированном списке.
-c — это опция, которая заставляет uniq не просто удалять дубликаты, но и подсчитывать количество их вхождений.